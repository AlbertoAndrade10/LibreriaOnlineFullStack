<form [formGroup]="bookForm" (ngSubmit)="onSubmit()" class="space-y-4">
    <!-- Mensaje de error general -->
    @if (errorMessage) {
    <div class="mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-md">
        {{ errorMessage }}
    </div>
    }

    <!-- Nombre del libro -->
    <div class="mb-4">
        <label for="bookName" class="block text-sm font-medium text-gray-700 mb-2">Nombre del libro *</label>
        <input type="text" id="bookName" formControlName="bookName"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            placeholder="Ingrese el nombre del libro">

        @if (bookName?.invalid && bookName?.touched) {
        <div class="text-red-600 text-sm mt-1">
            @if (bookName?.errors?.['required']) {
            <div>El nombre del libro es obligatorio</div>
            }
            @if (bookName?.errors?.['minlength']) {
            <div>El nombre debe tener al menos 2 caracteres</div>
            }
            @if (bookName?.errors?.['maxlength']) {
            <div>El nombre no puede tener más de 100 caracteres</div>
            }
        </div>
        }
    </div>

    <!-- Autor -->
    <div class="mb-4">
        <label for="authorId" class="block text-sm font-medium text-gray-700 mb-2">Autor *</label>
        <select id="authorId" formControlName="authorId"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
            <option value="">Seleccione un autor</option>
            @for (author of authors; track author.id) {
            <option [value]="author.id">
                {{ author.authorName }}
            </option>
            }
        </select>

        @if (authorId?.invalid && authorId?.touched) {
        <div class="text-red-600 text-sm mt-1">
            @if (authorId?.errors?.['required']) {
            <div>Por favor seleccione un autor</div>
            }
        </div>
        }
    </div>

    <!-- Género Literario -->
    <div class="mb-4">
        <label for="literaryGenreId" class="block text-sm font-medium text-gray-700 mb-2">Género Literario *</label>
        <select id="literaryGenreId" formControlName="literaryGenreId"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
            <option value="">Seleccione un género</option>
            @for (genre of literaryGenres; track genre.id) {
            <option [value]="genre.id">
                {{ genre.literaryGenreName }}
            </option>
            }
        </select>

        @if (literaryGenreId?.invalid && literaryGenreId?.touched) {
        <div class="text-red-600 text-sm mt-1">
            @if (literaryGenreId?.errors?.['required']) {
            <div>Por favor seleccione un género literario</div>
            }
        </div>
        }
    </div>

    <!-- Precio -->
    <div class="mb-4">
        <label for="price" class="block text-sm font-medium text-gray-700 mb-2">Precio *</label>
        <input type="number" id="price" formControlName="price" step="0.01" min="0.01"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            placeholder="0.00">

        @if (price?.invalid && price?.touched) {
        <div class="text-red-600 text-sm mt-1">
            @if (price?.errors?.['required']) {
            <div>El precio es obligatorio</div>
            }
            @if (price?.errors?.['min']) {
            <div>El precio debe ser mayor a 0</div>
            }
            @if (price?.errors?.['max']) {
            <div>El precio es demasiado alto</div>
            }
        </div>
        }
    </div>

    <!-- Descripción -->
    <div class="mb-4">
        <label for="description" class="block text-sm font-medium text-gray-700 mb-2">Descripción *</label>
        <textarea id="description" formControlName="description" rows="4"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            placeholder="Ingrese la descripción del libro"></textarea>

        @if (description?.invalid && description?.touched) {
        <div class="text-red-600 text-sm mt-1">
            @if (description?.errors?.['required']) {
            <div>La descripción es obligatoria</div>
            }
            @if (description?.errors?.['minlength']) {
            <div>La descripción debe tener al menos 10 caracteres</div>
            }
            @if (description?.errors?.['maxlength']) {
            <div>La descripción no puede tener más de 1000 caracteres</div>
            }
        </div>
        }
    </div>

    <!-- Stock -->
    <div class="mb-4">
        <label for="stock" class="block text-sm font-medium text-gray-700 mb-2">Stock *</label>
        <input type="number" id="stock" formControlName="stock" min="0"
            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
            placeholder="0">

        @if (stock?.invalid && stock?.touched) {
        <div class="text-red-600 text-sm mt-1">
            @if (stock?.errors?.['required']) {
            <div>El stock es obligatorio</div>
            }
            @if (stock?.errors?.['min']) {
            <div>El stock no puede ser negativo</div>
            }
            @if (stock?.errors?.['max']) {
            <div>El stock es demasiado alto</div>
            }
        </div>
        }
    </div>

    <!-- Imagen -->
    <div class="mb-4">
        <label for="image" class="block text-sm font-medium text-gray-700 mb-2">Imagen del libro</label>
        <div class="flex items-center space-x-4">
            <input type="file" id="image" (change)="onFileChange($event)" accept="image/*" class="block w-full text-sm text-gray-500
               file:mr-4 file:py-2 file:px-4
               file:rounded-md file:border-0
               file:text-sm file:font-semibold
               file:bg-blue-50 file:text-blue-700
               hover:file:bg-blue-100">
        </div>

        <!-- Vista previa de la imagen -->
        @if (previewUrl) {
        <div class="mt-4">
            <img [src]="previewUrl" alt="Vista previa" class="max-w-xs max-h-48 rounded-md shadow-sm">
        </div>
        }
    </div>

    <!-- Botones -->
    <div class="flex justify-end space-x-3 pt-4">
        <button type="button" (click)="onCancel()"
            class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300"
            [disabled]="isLoading">
            Cancelar
        </button>
        <button type="submit" [disabled]="bookForm.invalid || isLoading"
            class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed">
            @if (isLoading) {
            <span class="flex items-center">
                <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
                    viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                    </path>
                </svg>
                Guardando...
            </span>
            } @else {
            Guardar Libro
            }
        </button>
    </div>
</form>